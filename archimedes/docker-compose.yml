version: '3.9'

# To deploy multiple replicas, we'd use deploy: replicas: {number}
# depends-on hierarchy: db -> eureka-server -> survey-service & campaign-service

services:
  db:
    image: postgres:alpine
    restart: always
    ports:
      - 5432:5432
    environment:
      - POSTGRES_USER=thedockeruser
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=thedockerdb
  eureka-server:
    build: ./eureka-server/
    ports:
      - 8761:8761
    depends_on:
      - db
  survey-service:
    build: ./survey/survey-service/
    # No ports, as they're generated at random
    depends_on:
      - eureka-server
  campaign-service:
    build: ./campaign/campaign-service/
    # No ports, as they're generated at random
    depends_on:
      - eureka-server
